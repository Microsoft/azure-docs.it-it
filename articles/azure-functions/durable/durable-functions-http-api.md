---
title: HTTP APIs in Durable Functions - Azure Functions
description: Informazioni su come implementare API HTTP nell'estensione Funzioni permanenti per Funzioni di Azure.
author: cgillum
ms.topic: conceptual
ms.date: 12/17/2019
ms.author: azfuncdf
ms.openlocfilehash: 4e4081ecca4714c713d105d363a83a4f96a0d3fc
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/28/2020
ms.locfileid: "79278168"
---
# <a name="http-api-reference"></a>Informazioni di riferimento sulle API HTTP

L'estensione Funzioni permanenti espone un set di API HTTP predefinite che possono essere utilizzate per eseguire attività di gestione su [orchestrazioni,](durable-functions-types-features-overview.md#orchestrator-functions) [entità](durable-functions-types-features-overview.md#entity-functions)e [hub attività.](durable-functions-task-hubs.md) Queste API HTTP sono webhook di estensibilità che vengono autorizzati dall'host funzioni di Azure ma gestiti direttamente dall'estensione Funzioni permanenti.

Tutte le API HTTP implementate dall'estensione richiedono i parametri seguenti. Il tipo di dati di tutti i parametri è `string`.

| Parametro        | Tipo di parametro  | Descrizione |
|------------------|-----------------|-------------|
| **`taskHub`**    | Stringa di query    | Nome dell'[hub attività](durable-functions-task-hubs.md). Se non specificato, viene usato il nome dell'hub attività dell'app per le funzioni corrente. |
| **`connection`** | Stringa di query    | **Nome** della stringa di connessione per l'account di archiviazione. Se non specificato, viene usata la stringa di connessione predefinita dell'app per le funzioni. |
| **`systemKey`**  | Stringa di query    | Chiave di autorizzazione necessaria per richiamare l'API. |

`systemKey`è una chiave di autorizzazione generata automaticamente dall'host Funzioni di Azure.Is an authorization key autogenerated by the Azure Functions host. In particolare, concede l'accesso alle API dell'estensione Durable Task e può essere gestita allo stesso modo di [altre chiavi di autorizzazione](https://github.com/Azure/azure-webjobs-sdk-script/wiki/Key-management-API). È possibile generare URL che `taskHub` `connection`contengono `systemKey` i valori di stringa , e di query `CreateHttpManagementPayload` corretti utilizzando le API di `createCheckStatusResponse` `createHttpManagementPayload` associazione client dell'orchestrazione, ad esempio le [orchestration client binding](durable-functions-bindings.md#orchestration-client) `CreateCheckStatusResponse` API e in .NET o le API e in JavaScript.

Le prossime sezioni illustrano le specifiche API HTTP supportate dall'estensione e offrono esempi su come possono essere usate.

## <a name="start-orchestration"></a>Avviare l'orchestrazioneStart orchestration

Avvia l'esecuzione di una nuova istanza della funzione dell'agente di orchestrazione specificata.

### <a name="request"></a>Richiesta

Per la versione 1.x del runtime di Funzioni, la richiesta viene formattata come segue (vengono visualizzate più righe per maggiore chiarezza):

```http
POST /admin/extensions/DurableTaskExtension/orchestrators/{functionName}/{instanceId?}
     ?taskHub={taskHub}
     &connection={connectionName}
     &code={systemKey}
```

Nella versione 2.x del runtime di Funzioni, il formato URL ha tutti gli stessi parametri ma con un prefisso leggermente diverso:

```http
POST /runtime/webhooks/durabletask/orchestrators/{functionName}/{instanceId?}
     ?taskHub={taskHub}
     &connection={connectionName}
     &code={systemKey}
```

I parametri della richiesta per questa API includono il set predefinito indicato in precedenza, nonché i parametri univoci seguenti:

| Campo              | Tipo di parametro  | Descrizione |
|--------------------|-----------------|-------------|
| **`functionName`** | URL             | Nome della funzione dell'agente di orchestrazione da avviare. |
| **`instanceId`**   | URL             | Parametro facoltativo. ID dell'istanza di orchestrazione. Se non viene specificata, la funzione dell'agente di orchestrazione verrà avviata con un ID istanza casuale. |
| **`{content}`**    | Contenuto della richiesta | Facoltativa. Input della funzione dell'agente di orchestrazione in formato JSON. |

### <a name="response"></a>Risposta

Possono essere restituiti diversi valori di codice di stato.

* **HTTP 202 (Accettato):** la funzione dell'agente di orchestrazione specificata è stata pianificata per l'avvio dell'esecuzione. L'intestazione `Location` della risposta contiene un URL per il polling dello stato dell'orchestrazione.
* **HTTP 400 (richiesta non valida):** la funzione dell'agente di orchestrazione specificata non esiste, l'ID istanza specificato non è valido o il contenuto della richiesta non è JSON valido.

Di seguito è riportata `RestartVMs` una richiesta di esempio che avvia una funzione dell'agente di orchestrazione e include il payload dell'oggetto JSON:The following is an example request that starts a orchestrator function and includes JSON object payload:

```http
POST /runtime/webhooks/durabletask/orchestrators/RestartVMs?code=XXX
Content-Type: application/json
Content-Length: 83

{
    "resourceGroup": "myRG",
    "subscriptionId": "111deb5d-09df-4604-992e-a968345530a9"
}
```

Il payload della risposta per i casi HTTP 202 è un oggetto JSON con i campi seguenti:The response payload for the **HTTP 202** cases is a JSON object with the following fields:

| Campo                       | Descrizione                          |
|-----------------------------|--------------------------------------|
| **`id`**                    |ID dell'istanza di orchestrazione. |
| **`statusQueryGetUri`**     |URL di stato dell'istanza di orchestrazione. |
| **`sendEventPostUri`**      |URL di generazione evento dell'istanza di orchestrazione. |
| **`terminatePostUri`**      |URL di terminazione dell'istanza di orchestrazione. |
| **`purgeHistoryDeleteUri`** |URL "cronologia eliminazione" dell'istanza dell'orchestrazione. |
| **`rewindPostUri`**         |(anteprima) URL di "riavvolgimento" dell'istanza dell'orchestrazione. |

Il tipo di dati di tutti i campi è `string`.

Ecco un payload di risposta di esempio `abc123` per un'istanza di orchestrazione con come ID (formattato per leggibilità):Here is an example response payload for an orchestration instance with as its ID (formatted for readability):

```http
{
    "id": "abc123",
    "purgeHistoryDeleteUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123?code=XXX",
    "sendEventPostUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123/raiseEvent/{eventName}?code=XXX",
    "statusQueryGetUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123?code=XXX",
    "terminatePostUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123/terminate?reason={text}&code=XXX"
}
```

La risposta HTTP deve essere compatibile con il *modello di consumer*di polling . Include inoltre le intestazioni di risposta importanti seguenti:It also includes the following notable response headers:

* **Location (Percorso):** l'URL dell'endpoint di stato. Questo URL contiene lo `statusQueryGetUri` stesso valore del campo.
* **Riprova dopo:** numero di secondi di attesa tra le operazioni di polling. Il valore predefinito è `10`.

Per altre informazioni sul modello di polling HTTP asincrono, vedere la documentazione relativa al rilevamento delle [operazioni asincrone HTTP.](durable-functions-http-features.md#async-operation-tracking)

## <a name="get-instance-status"></a>Get instance status (Ottieni stato istanza)

Ottiene lo stato di un'istanza di orchestrazione specificata.

### <a name="request"></a>Richiesta

Per la versione 1.x del runtime di Funzioni, la richiesta viene formattata come segue (vengono visualizzate più righe per maggiore chiarezza):

```http
GET /admin/extensions/DurableTaskExtension/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &showHistory=[true|false]
    &showHistoryOutput=[true|false]
    &showInput=[true|false]
```

Nella versione 2.x del runtime di Funzioni, il formato URL ha tutti gli stessi parametri ma con un prefisso leggermente diverso:

```http
GET /runtime/webhooks/durabletask/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &showHistory=[true|false]
    &showHistoryOutput=[true|false]
    &showInput=[true|false]
```

I parametri della richiesta per questa API includono il set predefinito indicato in precedenza, nonché i parametri univoci seguenti:

| Campo                   | Tipo di parametro  | Descrizione |
|-------------------------|-----------------|-------------|
| **`instanceId`**        | URL             | ID dell'istanza di orchestrazione. |
| **`showInput`**         | Stringa di query    | Parametro facoltativo. Se impostato `false`su , l'input della funzione non verrà incluso nel payload della risposta.|
| **`showHistory`**       | Stringa di query    | Parametro facoltativo. Se impostato su `true`, la cronologia di esecuzione dell'orchestrazione verrà inclusa nel payload della risposta.|
| **`showHistoryOutput`** | Stringa di query    | Parametro facoltativo. Se impostato `true`su , gli output della funzione verranno inclusi nella cronologia di esecuzione dell'orchestrazione.|
| **`createdTimeFrom`**   | Stringa di query    | Parametro facoltativo. Se specificato, filtra l'elenco delle istanze restituite create in corrispondenza o dopo il timestamp ISO8601 specificato.|
| **`createdTimeTo`**     | Stringa di query    | Parametro facoltativo. Se specificato, filtra l'elenco delle istanze restituite create in corrispondenza o prima del timestamp ISO8601 specificato.|
| **`runtimeStatus`**     | Stringa di query    | Parametro facoltativo. Se specificato, filtra l'elenco delle istanze restituite in base allo stato del runtime. Per visualizzare l'elenco dei possibili valori di stato di runtime, vedere l'articolo Esecuzione di query sulle [istanze.](durable-functions-instance-management.md) |

### <a name="response"></a>Risposta

Possono essere restituiti diversi valori di codice di stato.

* **HTTP 200 (OK)**: l'istanza specificata è in stato completato.
* **HTTP 202 (Accettata )**: l'istanza specificata è in esecuzione.
* **HTTP 400 (Richiesta non valida)**: l'istanza specificata ha avuto esito negativo o è stata terminata.
* **HTTP 404 (Non trovata)**: l'istanza specificata non esiste o l'esecuzione non è iniziata.
* **HTTP 500 (Errore interno del server)**: si è verificato un errore dell'istanza specificata con un'eccezione non gestita.

Il payload di risposta per i casi **HTTP 200** e **HTTP 202** è un oggetto JSON con i campi seguenti:

| Campo                 | Tipo di dati | Descrizione |
|-----------------------|-----------|-------------|
| **`runtimeStatus`**   | string    | Stato di runtime dell'istanza. I valori includono *In esecuzione*, *In sospeso*, *Non riuscito*, *Annullato*, *Terminato*, *Completato*. |
| **`input`**           | JSON      | Dati JSON usati per inizializzare l'istanza. Questo campo è `null` quando il parametro della stringa di query `showInput` è impostato su `false`.|
| **`customStatus`**    | JSON      | I dati JSON usati per lo stato dell'orchestrazione personalizzato. Se non impostato, il campo è `null`. |
| **`output`**          | JSON      | Output JSON dell'istanza. Questo campo è `null` se l'istanza non è in stato completato. |
| **`createdTime`**     | string    | Data e ora di creazione dell'istanza. Usa la notazione estesa ISO 8601. |
| **`lastUpdatedTime`** | string    | Data e ora dell'ultimo stato persistente dell'istanza. Usa la notazione estesa ISO 8601. |
| **`historyEvents`**   | JSON      | Matrice JSON contenente la cronologia di esecuzione dell'orchestrazione. Questo campo è `null` a meno che il parametro della stringa di query `showHistory` non sia impostato su `true`. |

Ecco un payload di risposta di esempio che include la cronologia di esecuzione dell'orchestrazione e gli output delle attività (formattato per migliorarne la leggibilità):

```json
{
  "createdTime": "2018-02-28T05:18:49Z",
  "historyEvents": [
      {
          "EventType": "ExecutionStarted",
          "FunctionName": "E1_HelloSequence",
          "Timestamp": "2018-02-28T05:18:49.3452372Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello Tokyo!",
          "ScheduledTime": "2018-02-28T05:18:51.3939873Z",
          "Timestamp": "2018-02-28T05:18:52.2895622Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello Seattle!",
          "ScheduledTime": "2018-02-28T05:18:52.8755705Z",
          "Timestamp": "2018-02-28T05:18:53.1765771Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello London!",
          "ScheduledTime": "2018-02-28T05:18:53.5170791Z",
          "Timestamp": "2018-02-28T05:18:53.891081Z"
      },
      {
          "EventType": "ExecutionCompleted",
          "OrchestrationStatus": "Completed",
          "Result": [
              "Hello Tokyo!",
              "Hello Seattle!",
              "Hello London!"
          ],
          "Timestamp": "2018-02-28T05:18:54.3660895Z"
      }
  ],
  "input": null,
  "customStatus": { "nextActions": ["A", "B", "C"], "foo": 2 },
  "lastUpdatedTime": "2018-02-28T05:18:54Z",
  "output": [
      "Hello Tokyo!",
      "Hello Seattle!",
      "Hello London!"
  ],
  "runtimeStatus": "Completed"
}
```

La risposta **HTTP 202** include anche un'intestazione di risposta **Location** che referenzia lo stesso URL del campo `statusQueryGetUri` citato in precedenza.

## <a name="get-all-instances-status"></a>Ottenere lo stato di tutte le istanze

È inoltre possibile eseguire una query sullo `instanceId` stato di tutte le istanze rimuovendo il dalla richiesta 'Ottieni stato istanza'. In questo caso, i parametri di base sono gli stessi di 'Get instance status'. Sono supportati anche i parametri della stringa di query per il filtro.

Tenere presente che `connection` e `code` sono facoltativi. Se si dispone di autenticazione `code` anonima sulla funzione, quindi non è necessario.
Se non si vuole usare una stringa di connessione di archiviazione diversa da quella definita nell'impostazione dell'app AzureWebJobsStorage, è possibile ignorare il parametro della stringa di query di connessione.

### <a name="request"></a>Richiesta

Per la versione 1.x del runtime di Funzioni, la richiesta viene formattata come segue (vengono visualizzate più righe per maggiore chiarezza):

```http
GET /admin/extensions/DurableTaskExtension/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
    &showInput=[true|false]
    &top={integer}
```

Nella versione 2.x del runtime di Funzioni, il formato URL ha tutti gli stessi parametri ma con un prefisso leggermente diverso:

```http
GET /runtime/webhooks/durableTask/instances?
    taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
    &showInput=[true|false]
    &top={integer}
```

I parametri della richiesta per questa API includono il set predefinito indicato in precedenza, nonché i parametri univoci seguenti:

| Campo                   | Tipo di parametro  | Descrizione |
|-------------------------|-----------------|-------------|
| **`instanceId`**        | URL             | ID dell'istanza di orchestrazione. |
| **`showInput`**         | Stringa di query    | Parametro facoltativo. Se impostato `false`su , l'input della funzione non verrà incluso nel payload della risposta.|
| **`showHistory`**       | Stringa di query    | Parametro facoltativo. Se impostato su `true`, la cronologia di esecuzione dell'orchestrazione verrà inclusa nel payload della risposta.|
| **`showHistoryOutput`** | Stringa di query    | Parametro facoltativo. Se impostato `true`su , gli output della funzione verranno inclusi nella cronologia di esecuzione dell'orchestrazione.|
| **`createdTimeFrom`**   | Stringa di query    | Parametro facoltativo. Se specificato, filtra l'elenco delle istanze restituite create in corrispondenza o dopo il timestamp ISO8601 specificato.|
| **`createdTimeTo`**     | Stringa di query    | Parametro facoltativo. Se specificato, filtra l'elenco delle istanze restituite create in corrispondenza o prima del timestamp ISO8601 specificato.|
| **`runtimeStatus`**     | Stringa di query    | Parametro facoltativo. Se specificato, filtra l'elenco delle istanze restituite in base allo stato del runtime. Per visualizzare l'elenco dei possibili valori di stato di runtime, vedere l'articolo Esecuzione di query sulle [istanze.](durable-functions-instance-management.md) |
| **`top`**               | Stringa di query    | Parametro facoltativo. Se specificato, limita il numero di istanze restituite dalla query. |

### <a name="response"></a>Risposta

Di seguito è riportato un esempio di payload di risposta, compreso lo stato dell'orchestrazione (formattato per migliorare la leggibilità):

```json
[
    {
        "instanceId": "7af46ff000564c65aafbfe99d07c32a5",
        "runtimeStatus": "Completed",
        "input": null,
        "customStatus": null,
        "output": [
            "Hello Tokyo!",
            "Hello Seattle!",
            "Hello London!"
        ],
        "createdTime": "2018-06-04T10:46:39Z",
        "lastUpdatedTime": "2018-06-04T10:46:47Z"
    },
    {
        "instanceId": "80eb7dd5c22f4eeba9f42b062794321e",
        "runtimeStatus": "Running",
        "input": null,
        "customStatus": null,
        "output": null,
        "createdTime": "2018-06-04T15:18:28Z",
        "lastUpdatedTime": "2018-06-04T15:18:38Z"
    },
    {
        "instanceId": "9124518926db408ab8dfe84822aba2b1",
        "runtimeStatus": "Completed",
        "input": null,
        "customStatus": null,
        "output": [
            "Hello Tokyo!",
            "Hello Seattle!",
            "Hello London!"
        ],
        "createdTime": "2018-06-04T10:46:54Z",
        "lastUpdatedTime": "2018-06-04T10:47:03Z"
    },
    {
        "instanceId": "d100b90b903c4009ba1a90868331b11b",
        "runtimeStatus": "Pending",
        "input": null,
        "customStatus": null,
        "output": null,
        "createdTime": "2018-06-04T15:18:39Z",
        "lastUpdatedTime": "2018-06-04T15:18:39Z"
    }
]
```

> [!NOTE]
> Questa operazione può risultare molto costosa in termini di Archiviazione di Azure I/O se sono presenti molte righe nella tabella delle istanze. Altre informazioni sulla tabella di istanza sono reperibili nella documentazione [Prestazioni e scalabilità in Funzioni permanenti (Funzioni di Azure)](durable-functions-perf-and-scale.md#instances-table).
>

Se esistono più risultati, viene restituito un token di continuazione nell'intestazione della risposta.  Il nome dell’intestazione è `x-ms-continuation-token`.

Se si imposta il valore del token di continuazione nell'intestazione della richiesta successiva, è possibile ottenere la pagina successiva dei risultati. Anche questo nome dell'intestazione della richiesta è `x-ms-continuation-token`.

## <a name="purge-single-instance-history"></a>Eliminare la cronologia di una singola istanzaPurge single instance history

Elimina la cronologia e gli elementi correlati per un'istanza di orchestrazione specificata.

### <a name="request"></a>Richiesta

Per la versione 1.x del runtime di Funzioni, la richiesta viene formattata come segue (vengono visualizzate più righe per maggiore chiarezza):

```http
DELETE /admin/extensions/DurableTaskExtension/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connection}
    &code={systemKey}
```

Nella versione 2.x del runtime di Funzioni, il formato URL ha tutti gli stessi parametri ma con un prefisso leggermente diverso:

```http
DELETE /runtime/webhooks/durabletask/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connection}
    &code={systemKey}
```

I parametri della richiesta per questa API includono il set predefinito indicato in precedenza, nonché i parametri univoci seguenti:

| Campo             | Tipo di parametro  | Descrizione |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL             | ID dell'istanza di orchestrazione. |

### <a name="response"></a>Risposta

È possibile restituire i seguenti valori del codice di stato HTTP.

* **HTTP 200 (OK):** la cronologia dell'istanza è stata eliminata correttamente.
* **HTTP 404 (Non trovato):** l'istanza specificata non esiste.

Il payload della risposta per il caso **HTTP 200** è un oggetto JSON con il seguente campo:

| Campo                  | Tipo di dati | Descrizione |
|------------------------|-----------|-------------|
| **`instancesDeleted`** | integer   | Numero di istanze eliminate. Per il caso a istanza singola, questo valore deve essere `1`sempre . |

Di seguito è riportato un payload di risposta di esempio (formattato per migliorare la leggibilità):

```json
{
    "instancesDeleted": 1
}
```

## <a name="purge-multiple-instance-histories"></a>Eliminare le cronologie di più istanzePurge multiple instance history

È inoltre possibile eliminare la cronologia e gli elementi correlati `{instanceId}` per più istanze all'interno di un hub attività rimuovendo la dalla richiesta 'Elimina cronologia istanza singola'. Per eliminare in modo selettivo la cronologia delle istanze, utilizzare gli stessi filtri descritti nella richiesta 'Ottieni lo stato di tutte le istanze'.

### <a name="request"></a>Richiesta

Per la versione 1.x del runtime di Funzioni, la richiesta viene formattata come segue (vengono visualizzate più righe per maggiore chiarezza):

```http
DELETE /admin/extensions/DurableTaskExtension/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
```

Nella versione 2.x del runtime di Funzioni, il formato URL ha tutti gli stessi parametri ma con un prefisso leggermente diverso:

```http
DELETE /runtime/webhooks/durabletask/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
```

I parametri della richiesta per questa API includono il set predefinito indicato in precedenza, nonché i parametri univoci seguenti:

| Campo                 | Tipo di parametro  | Descrizione |
|-----------------------|-----------------|-------------|
| **`createdTimeFrom`** | Stringa di query    | Filtra l'elenco delle istanze eliminate create in corrispondenza o dopo il timestamp ISO8601 specificato.|
| **`createdTimeTo`**   | Stringa di query    | Parametro facoltativo. Se specificato, filtra l'elenco delle istanze eliminate create in corrispondenza o prima del timestamp ISO8601 specificato.|
| **`runtimeStatus`**   | Stringa di query    | Parametro facoltativo. Se specificato, filtra l'elenco delle istanze eliminate in base al relativo stato di runtime. Per visualizzare l'elenco dei possibili valori di stato di runtime, vedere l'articolo Esecuzione di query sulle [istanze.](durable-functions-instance-management.md) |

> [!NOTE]
> Questa operazione può essere molto costosa in termini di I/O di Archiviazione di Azure se sono presenti molte righe nelle tabelle Istanze e/o Cronologia.This operation can be very expensive in terms of Azure Storage I/O if there are a lot of rows in the Instances and/or History tables. Ulteriori dettagli su queste tabelle sono disponibili nella documentazione relativa a [prestazioni e scalabilità in Funzioni permanenti (Funzioni](durable-functions-perf-and-scale.md#instances-table) di Azure).

### <a name="response"></a>Risposta

È possibile restituire i seguenti valori del codice di stato HTTP.

* **HTTP 200 (OK):** la cronologia dell'istanza è stata eliminata correttamente.
* **HTTP 404 (Non trovato):** non sono state trovate istanze corrispondenti all'espressione di filtro.

Il payload della risposta per il caso **HTTP 200** è un oggetto JSON con il seguente campo:

| Campo                   | Tipo di dati | Descrizione |
|-------------------------|-----------|-------------|
| **`instancesDeleted`**  | integer   | Numero di istanze eliminate. |

Di seguito è riportato un payload di risposta di esempio (formattato per migliorare la leggibilità):

```json
{
    "instancesDeleted": 250
}
```

## <a name="raise-event"></a>Raise event (Genera evento)

Invia un messaggio di notifica evento per un'istanza di orchestrazione in esecuzione.

### <a name="request"></a>Richiesta

Per la versione 1.x del runtime di Funzioni, la richiesta viene formattata come segue (vengono visualizzate più righe per maggiore chiarezza):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/raiseEvent/{eventName}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

Nella versione 2.x del runtime di Funzioni, il formato URL ha tutti gli stessi parametri ma con un prefisso leggermente diverso:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/raiseEvent/{eventName}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

I parametri della richiesta per questa API includono il set predefinito indicato in precedenza, nonché i parametri univoci seguenti:

| Campo             | Tipo di parametro  | Descrizione |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL             | ID dell'istanza di orchestrazione. |
| **`eventName`**   | URL             | Nome dell'evento atteso dall'istanza di orchestrazione di destinazione. |
| **`{content}`**   | Contenuto della richiesta | Payload dell'evento in formato JSON. |

### <a name="response"></a>Risposta

Possono essere restituiti diversi valori di codice di stato.

* **HTTP 202 (Accettata)**: l'evento generato è stato accettato per l'elaborazione.
* **HTTP 400 (Richiesta non valida)**: il contenuto della richiesta non è di tipo `application/json` o non è un oggetto JSON valido.
* **HTTP 404 (Non trovata)**: l'istanza specificata non è stata trovata.
* **HTTP 410 (Non disponibile)**: l'istanza specificata è stata completata o ha avuto esito negativo e non può elaborare gli eventi generati.

Ecco una richiesta di esempio che invia la stringa JSON `"incr"` a un'istanza in attesa di un evento denominato **operation**:

```http
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/raiseEvent/operation?taskHub=DurableFunctionsHub&connection=Storage&code=XXX
Content-Type: application/json
Content-Length: 6

"incr"
```

Nelle risposte per questa API non è presente contenuto.

## <a name="terminate-instance"></a>Arresta istanza

Termina un'istanza di orchestrazione in esecuzione.

### <a name="request"></a>Richiesta

Per la versione 1.x del runtime di Funzioni, la richiesta viene formattata come segue (vengono visualizzate più righe per maggiore chiarezza):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/terminate
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

Nella versione 2.x del runtime di Funzioni, il formato URL ha tutti gli stessi parametri ma con un prefisso leggermente diverso:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/terminate
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

I parametri della richiesta per questa API includono il set predefinito indicato in precedenza, nonché i parametri univoci seguenti.

| Campo             | Tipo di parametro  | Descrizione |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL             | ID dell'istanza di orchestrazione. |
| **`reason`**      | Stringa di query    | Facoltativa. Motivo dell'interruzione dell'istanza di orchestrazione. |

### <a name="response"></a>Risposta

Possono essere restituiti diversi valori di codice di stato.

* **HTTP 202 (Accettata)**: la richiesta di interruzione è stata accettata per l'elaborazione.
* **HTTP 404 (Non trovata)**: l'istanza specificata non è stata trovata.
* **HTTP 410 (Non disponibile)**: l'istanza specificata è stata completata o ha avuto esito negativo.

Ecco un esempio di richiesta che termina un'istanza in esecuzione e specifica il motivo **buggy** (con errori):

```
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/terminate?reason=buggy&taskHub=DurableFunctionsHub&connection=Storage&code=XXX
```

Nelle risposte per questa API non è presente contenuto.

## <a name="rewind-instance-preview"></a>Ripristinare un'istanza (anteprima)

Ripristina lo stato in corso di esecuzione di un'istanza di orchestrazione non riuscita riproducendo le operazioni non riuscite più recenti.

### <a name="request"></a>Richiesta

Per la versione 1.x del runtime di Funzioni, la richiesta viene formattata come segue (vengono visualizzate più righe per maggiore chiarezza):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/rewind
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

Nella versione 2.x del runtime di Funzioni, il formato URL ha tutti gli stessi parametri ma con un prefisso leggermente diverso:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/rewind
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

I parametri della richiesta per questa API includono il set predefinito indicato in precedenza, nonché i parametri univoci seguenti.

| Campo             | Tipo di parametro  | Descrizione |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL             | ID dell'istanza di orchestrazione. |
| **`reason`**      | Stringa di query    | Facoltativa. Motivo del ripristino dell'istanza di orchestrazione. |

### <a name="response"></a>Risposta

Possono essere restituiti diversi valori di codice di stato.

* **HTTP 202 (Accettata)**: la richiesta di ripristino è stata accettata per l'elaborazione.
* **HTTP 404 (Non trovata)**: l'istanza specificata non è stata trovata.
* **HTTP 410 (Non disponibile)**: l'istanza specificata è stata completata o terminata.

Di seguito è riportato un esempio di richiesta che ripristina un'istanza non riuscita e specifica il motivo **fixed** (corretto):

```http
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/rewind?reason=fixed&taskHub=DurableFunctionsHub&connection=Storage&code=XXX
```

Nelle risposte per questa API non è presente contenuto.

## <a name="signal-entity"></a>Entità segnale

Invia un messaggio di operazione unidirezionale a [un'entità durevole.](durable-functions-types-features-overview.md#entity-functions) Se l'entità non esiste, verrà creata automaticamente.

> [!NOTE]
> Le entità durevoli sono disponibili a partire da Funzioni durevoli 2.0.Durable entities are available starting in Durable Functions 2.0.

### <a name="request"></a>Richiesta

La richiesta HTTP viene formattata come segue (più righe vengono visualizzate per maggiore chiarezza):

```http
POST /runtime/webhooks/durabletask/entities/{entityName}/{entityKey}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &op={operationName}
```

I parametri della richiesta per questa API includono il set predefinito indicato in precedenza, nonché i parametri univoci seguenti:

| Campo             | Tipo di parametro  | Descrizione |
|-------------------|-----------------|-------------|
| **`entityName`**  | URL             | Nome (tipo) dell'entità. |
| **`entityKey`**   | URL             | Chiave (ID univoco) dell'entità. |
| **`op`**          | Stringa di query    | Facoltativa. Nome dell'operazione definita dall'utente da richiamare. |
| **`{content}`**   | Contenuto della richiesta | Payload dell'evento in formato JSON. |

Di seguito è riportato un esempio di richiesta `Counter` che `steps`invia un messaggio "Aggiungi" definito dall'utente a un'entità denominata . Il contenuto del messaggio `5`è il valore . Se l'entità non esiste già, verrà creata da questa richiesta:If the entity does not already exist, it will be created by this request:

```http
POST /runtime/webhooks/durabletask/entities/Counter/steps?op=Add
Content-Type: application/json

5
```

> [!NOTE]
> Per impostazione predefinita con le entità basate `op` su `delete` classi [in .NET](durable-functions-dotnet-entities.md#defining-entity-classes), specificando il valore di eliminerà lo stato di un'entità. Se l'entità definisce `delete`un'operazione denominata , tuttavia, tale operazione definita dall'utente verrà invece richiamata.

### <a name="response"></a>Risposta

Questa operazione ha diverse risposte possibili:

* **HTTP 202 (Accepted):** l'operazione del segnale è stata accettata per l'elaborazione asincrona.
* **HTTP 400 (richiesta non valida):** il `application/json`contenuto della richiesta non era `entityKey` di tipo , non era JSON valido o aveva un valore non valido.
* **HTTP 404 (Non trovato):** l'oggetto specificato `entityName` non è stato trovato.

Una richiesta HTTP riuscita non include alcun contenuto nella risposta. Una richiesta HTTP non riuscita può contenere informazioni sull'errore in formato JSON nel contenuto della risposta.

## <a name="get-entity"></a>Ottenere l'entitàGet entity

Ottiene lo stato dell'entità specificata.

### <a name="request"></a>Richiesta

La richiesta HTTP viene formattata come segue (più righe vengono visualizzate per maggiore chiarezza):

```http
GET /runtime/webhooks/durabletask/entities/{entityName}/{entityKey}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

### <a name="response"></a>Risposta

Questa operazione ha due possibili risposte:

* **HTTP 200 (OK):** l'entità specificata esiste.
* **HTTP 404 (Non trovato):** l'entità specificata non è stata trovata.

Una risposta corretta contiene lo stato serializzato JSON dell'entità come contenuto.

### <a name="example"></a>Esempio
La richiesta HTTP di esempio seguente `Counter` ottiene `steps`lo stato di un'entità esistente denominata:

```http
GET /runtime/webhooks/durabletask/entities/Counter/steps
```

Se `Counter` l'entità contiene semplicemente una `currentValue` serie di passaggi salvati in un campo, il contenuto della risposta potrebbe essere simile al seguente (formattato per la leggibilità):

```json
{
    "currentValue": 5
}
```

## <a name="list-entities"></a>Elencare le entità

È possibile eseguire una query per più entità in base al nome dell'entità o alla data dell'ultima operazione.

### <a name="request"></a>Richiesta

La richiesta HTTP viene formattata come segue (più righe vengono visualizzate per maggiore chiarezza):

```http
GET /runtime/webhooks/durabletask/entities/{entityName}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &lastOperationTimeFrom={timestamp}
    &lastOperationTimeTo={timestamp}
    &fetchState=[true|false]
    &top={integer}
```

I parametri della richiesta per questa API includono il set predefinito indicato in precedenza, nonché i parametri univoci seguenti:

| Campo                       | Tipo di parametro  | Descrizione |
|-----------------------------|-----------------|-------------|
| **`entityName`**            | URL             | Facoltativa. Se specificato, filtra l'elenco delle entità restituite in base al nome dell'entità (senza distinzione tra maiuscole e minuscole). |
| **`fetchState`**            | Stringa di query    | Parametro facoltativo. Se impostato `true`su , lo stato dell'entità verrà incluso nel payload della risposta. |
| **`lastOperationTimeFrom`** | Stringa di query    | Parametro facoltativo. Se specificato, filtra l'elenco delle entità restituite che hanno elaborato le operazioni dopo il timestamp ISO8601 specificato. |
| **`lastOperationTimeTo`**   | Stringa di query    | Parametro facoltativo. Se specificato, filtra l'elenco delle entità restituite che hanno elaborato le operazioni prima del timestamp ISO8601 specificato. |
| **`top`**                   | Stringa di query    | Parametro facoltativo. Se specificato, limita il numero di entità restituite dalla query. |


### <a name="response"></a>Risposta

Una risposta HTTP 200 corretta contiene una matrice serializzata JSON di entità e, facoltativamente, lo stato di ogni entità.

Per impostazione predefinita, l'operazione restituisce le prime 100 entità che corrispondono ai criteri di query. Il chiamante può specificare `top` un valore di parametro della stringa di query per restituire un numero massimo di risultati diverso. Se esistono più risultati oltre a ciò che viene restituito, viene restituito anche un token di continuazione nell'intestazione della risposta. Il nome dell’intestazione è `x-ms-continuation-token`.

Se si imposta il valore del token di continuazione nell'intestazione della richiesta successiva, è possibile ottenere la pagina successiva dei risultati. Anche questo nome dell'intestazione della richiesta è `x-ms-continuation-token`.

### <a name="example---list-all-entities"></a>Esempio - elenca tutte le entità

La richiesta HTTP di esempio seguente elenca tutte le entità nell'hub attività:The following example HTTP request lists all entities in the task hub:

```http
GET /runtime/webhooks/durabletask/entities
```

La risposta JSON potrebbe essere simile alla seguente (formattata per leggibilità):The response JSON may look like the following (formatted for readability):

```json
[
    {
        "entityId": { "key": "cats", "name": "counter" },
        "lastOperationTime": "2019-12-18T21:45:44.6326361Z",
    },
    {
        "entityId": { "key": "dogs", "name": "counter" },
        "lastOperationTime": "2019-12-18T21:46:01.9477382Z"
    },
    {
        "entityId": { "key": "mice", "name": "counter" },
        "lastOperationTime": "2019-12-18T21:46:15.4626159Z"
    },
    {
        "entityId": { "key": "radio", "name": "device" },
        "lastOperationTime": "2019-12-18T21:46:18.2616154Z"
    },
]
```

### <a name="example---filtering-the-list-of-entities"></a>Esempio- filtraggio dell'elenco di entità

La richiesta HTTP di esempio seguente elenca `counter` solo le prime due entità di tipo e ne recupera anche lo stato:

```http
GET /runtime/webhooks/durabletask/entities/counter?top=2&fetchState=true
```

La risposta JSON potrebbe essere simile alla seguente (formattata per leggibilità):The response JSON may look like the following (formatted for readability):

```json
[
    {
        "entityId": { "key": "cats", "name": "counter" },
        "lastOperationTime": "2019-12-18T21:45:44.6326361Z",
        "state": { "value": 9 }
    },
    {
        "entityId": { "key": "dogs", "name": "counter" },
        "lastOperationTime": "2019-12-18T21:46:01.9477382Z",
        "state": { "value": 10 }
    }
]
```

## <a name="next-steps"></a>Passaggi successivi

> [!div class="nextstepaction"]
> [Informazioni su come usare Application Insights per monitorare le funzioni durevoli](durable-functions-diagnostics.md)