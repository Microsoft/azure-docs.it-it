---
title: Valutazione della vulnerabilità di SQL
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Informazioni su come configurare la valutazione della vulnerabilità SQL e interpretare i report di valutazione nel database SQL di Azure, Azure SQL Istanza gestita e Azure sinapsi Analytics.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 02/11/2021
tags: azure-synapse
ms.openlocfilehash: 1719c5a7112ee32f86d0593d274a59638cf81a0e
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/19/2021
ms.locfileid: "100376629"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>La valutazione della vulnerabilità di SQL consente di identificare le vulnerabilità del database
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

La valutazione della vulnerabilità di SQL è un servizio facile da configurare che consente di individuare, monitorare e risolvere potenziali vulnerabilità del database. È consigliabile usarlo in modo proattivo per migliorare la sicurezza dei database.

La valutazione della vulnerabilità fa parte dell'offerta [Azure Defender for SQL](azure-defender-for-sql.md) , un pacchetto unificato per le funzionalità avanzate di sicurezza di SQL. La valutazione della vulnerabilità può essere accessibile e gestita tramite il portale di Azure Defender centrale per SQL.

> [!NOTE]
> La valutazione della vulnerabilità è supportata per il database SQL di Azure, Azure SQL Istanza gestita e Azure sinapsi Analytics. I database nel database SQL di Azure, Azure SQL Istanza gestita e Azure sinapsi Analytics vengono definiti collettivamente nel resto di questo articolo come database e il server fa riferimento al [Server](logical-servers.md) che ospita i database per il database SQL di Azure e la sinapsi di Azure.

## <a name="what-is-sql-vulnerability-assessment"></a>Che cos'è la valutazione della vulnerabilità di SQL?

La valutazione della vulnerabilità di SQL è un servizio che offre visibilità sullo stato di sicurezza. La valutazione della vulnerabilità include passaggi utilizzabili per risolvere i problemi di sicurezza e migliorare la sicurezza del database. Consente di monitorare un ambiente di database dinamico in cui le modifiche sono difficili da rilevare e migliorare il comportamento di sicurezza di SQL.

La valutazione della vulnerabilità è un servizio di analisi integrato nel database SQL di Azure. Il servizio usa una Knowledge base di regole che contrassegnano le vulnerabilità della sicurezza. Evidenzia le deviazioni dalle procedure consigliate, ad esempio configurazioni errate, autorizzazioni eccessive e dati sensibili non protetti.

Le regole sono basate sulle procedure consigliate di Microsoft e si concentrano sui problemi di sicurezza che presentano i maggiori rischi per il database e i relativi dati importanti. Si tratta di problemi a livello di database e di sicurezza a livello di server, ad esempio le impostazioni del firewall del server e le autorizzazioni a livello di server.

I risultati dell'analisi includono le azioni applicabili per risolvere ogni problema, oltre a script di correzione personalizzati, ove applicabile. È possibile personalizzare un report di valutazione per l'ambiente impostando una baseline accettabile per:

- Configurazioni delle autorizzazioni
- Configurazioni delle funzionalità
- Impostazioni database

## <a name="configure-vulnerability-assessment"></a>Configurare Valutazione della vulnerabilità

Per configurare la valutazione della vulnerabilità, seguire questa procedura:

1. Nella [portale di Azure](https://portal.azure.com)aprire la risorsa specifica nel database SQL di Azure, nel database SQL istanza gestita o nella sinapsi di Azure.

1. Sotto l'intestazione **sicurezza** selezionare **Centro sicurezza**.

1. Selezionare **Configura** sul collegamento per aprire il riquadro impostazioni di Azure Defender per SQL per l'intero server o l'istanza gestita.

    :::image type="content" source="media/sql-vulnerability-assessment/opening-sql-configuration.png" alt-text="Apertura del Defender per la configurazione SQL":::

    > [!NOTE]
    > La valutazione della vulnerabilità SQL richiede che **Azure Defender per** il piano SQL sia in grado di eseguire analisi. Per altre informazioni su come abilitare Azure Defender per SQL, vedere [Azure Defender per SQL](azure-defender-for-sql.md).

1. Nella pagina **Impostazioni server** definire le impostazioni di Azure Defender per SQL:

    :::image type="content" source="media/sql-vulnerability-assessment/sql-vulnerability-scan-settings.png" alt-text="Configurazione delle analisi di valutazione della vulnerabilità SQL":::

    1. Configurare un account di archiviazione in cui verranno archiviati i risultati dell'analisi per tutti i database nel server o nell'istanza gestita. Per altre informazioni sugli account di archiviazione, vedere [Informazioni sugli account di archiviazione di Azure](../../storage/common/storage-account-create.md).

        > [!TIP]
        > Per altre informazioni sull'archiviazione delle analisi di valutazione della vulnerabilità dietro i firewall e reti virtuali, vedere [archiviare la valutazione della vulnerabilità in un account di archiviazione accessibile dietro i firewall e reti virtuali](sql-database-vulnerability-assessment-storage.md).

    1. Per configurare le valutazioni delle vulnerabilità per eseguire automaticamente le analisi settimanali per rilevare le configurazioni di sicurezza non configurate, impostare **analisi periodiche periodiche** **su on**. I risultati vengono inviati agli indirizzi di posta elettronica forniti in **Invia report di analisi a**. È anche possibile inviare notifiche tramite posta elettronica agli amministratori e ai proprietari della sottoscrizione abilitando **anche l'invio di notifiche tramite posta elettronica agli amministratori e ai proprietari della sottoscrizione**.

1. È anche possibile eseguire analisi della vulnerabilità SQL su richiesta:

    1. Dalla pagina **Centro sicurezza** della risorsa selezionare **Visualizza ulteriori risultati nella valutazione della vulnerabilità** per accedere ai risultati dell'analisi da analisi precedenti.

        :::image type="content" source="media/sql-vulnerability-assessment/view-additional-findings-link.png" alt-text="Apertura dei risultati dell'analisi e delle opzioni di analisi manuale":::

    1. Per eseguire un'analisi su richiesta per analizzare le vulnerabilità del database, selezionare **Scan** dalla barra degli strumenti:

        :::image type="content" source="media/sql-vulnerability-assessment/on-demand-vulnerability-scan.png" alt-text="Selezionare Scan per eseguire un'analisi di valutazione della vulnerabilità su richiesta della risorsa SQL":::


  > [!NOTE]
  > L'analisi è un'operazione leggera e sicura, Sono necessari alcuni secondi per l'esecuzione ed è interamente di sola lettura. Non viene apportata alcuna modifica al database.

## <a name="remediate-vulnerabilities"></a>Correggi le vulnerabilità

Al termine di un'analisi delle vulnerabilità, il report viene visualizzato nella portale di Azure. Il report presenta:

- Panoramica dello stato di sicurezza
- Il numero di problemi trovati e
- Riepilogo per gravità dei rischi
- Elenco dei risultati per ulteriori indagini

:::image type="content" source="media/sql-vulnerability-assessment/sample-sql-vulnerabilities-report.png" alt-text="Report di analisi di sampl dallo scanner di valutazione della vulnerabilità di SQL":::

Per correggere le vulnerabilità individuate:

1. Esaminare i risultati e determinare quale dei risultati del report sono veri problemi di sicurezza per l'ambiente in uso.

1. Selezionare i risultati non riusciti per comprenderne l'effetto e il motivo per cui il controllo di sicurezza non è riuscito.

    > [!TIP]
    > La pagina Dettagli risultati include informazioni correttive che spiegano come risolvere il problema.

    :::image type="content" source="media/sql-vulnerability-assessment/examining-vulnerability-findings.gif" alt-text="Analisi dei risultati di un'analisi delle vulnerabilità":::

1. Quando si esaminano i risultati della valutazione, è possibile contrassegnare risultati specifici come una *baseline* accettabile nell'ambiente in uso. Una linea di base è essenzialmente una personalizzazione del modo in cui vengono restituiti i risultati. Nelle analisi successive i risultati che corrispondono alla baseline vengono considerati come passaggi. Dopo aver stabilito lo stato di sicurezza della linea di base, la valutazione della vulnerabilità segnala solo le deviazioni dalla linea di base. In questo modo, è possibile concentrare l'attenzione sui problemi rilevanti.

    :::image type="content" source="media/sql-vulnerability-assessment/baseline-approval.png" alt-text="Approvazione di una ricerca come base per analisi future":::

1. Se si modificano le linee di base, usare il pulsante **Scan** per eseguire un'analisi su richiesta e visualizzare il report personalizzato. Eventuali risultati aggiunti alla baseline verranno visualizzati in **passati** con un'indicazione che sono stati superati a causa delle modifiche della linea di base.

    :::image type="content" source="media/sql-vulnerability-assessment/passed-per-custom-baseline.png" alt-text="Valutazioni passate che indicano che sono state passate per ogni Baseline personalizzata":::

È ora possibile usare le analisi della valutazione della vulnerabilità per garantire che il database mantenga un elevato livello di sicurezza e che i criteri aziendali siano soddisfatti. 

## <a name="advanced-capabilities"></a>Funzionalità avanzate

### <a name="export-an-assessment-report"></a>Esportare un report di valutazione

Selezionare **Esporta risultati analisi** per creare un report di Excel scaricabile per il risultato dell'analisi. Questo report contiene una scheda riepilogativa che visualizza un riepilogo della valutazione. Il report include tutti i controlli non riusciti. Include inoltre una scheda **risultati** che contiene il set completo di risultati dell'analisi. I risultati includono tutti i controlli eseguiti e i relativi dettagli.

### <a name="view-scan-history"></a>Visualizzare la cronologia analisi

Selezionare **Cronologia analisi** nel riquadro valutazione della vulnerabilità per visualizzare la cronologia di tutte le analisi eseguite in precedenza nel database. Selezionare un'analisi specifica nell'elenco per visualizzarne i risultati dettagliati.

## <a name="manage-vulnerability-assessments-programmatically"></a>Gestire valutazioni delle vulnerabilità a livello di codice

### <a name="using-azure-powershell"></a>Uso di Azure PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> Il modulo Azure Resource Manager di PowerShell è ancora supportato, ma tutto lo sviluppo futuro riguarda il modulo AZ. SQL. Per informazioni su questi cmdlet, vedere [AzureRM.Sql](/powershell/module/AzureRM.Sql/). Gli argomenti per i comandi nei moduli Az e AzureRm sono sostanzialmente identici.

È possibile usare i cmdlet di Azure PowerShell per gestire a livello di codice le valutazioni delle vulnerabilità. I cmdlet supportati sono:

| Nome del cmdlet come collegamento | Descrizione |
| :-------------------- | :---------- |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Ottiene la baseline della regola di valutazione della vulnerabilità.<br/>Prima di tutto, impostare la linea di base prima di usare questo cmdlet per cancellarla. |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Cancella le impostazioni di valutazione della vulnerabilità di un database. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Cancella la linea di base della regola di valutazione della vulnerabilità di un database gestito.<br/>Prima di tutto, impostare la linea di base prima di usare questo cmdlet per cancellarla. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Cancella le impostazioni di valutazione della vulnerabilità di un database gestito. |
| [Clear-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting) | Cancella le impostazioni di valutazione della vulnerabilità di un'istanza gestita. |
| [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Converte i risultati dell'analisi della valutazione della vulnerabilità di un database in un file di Excel. |
| [Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Converte i risultati dell'analisi della valutazione della vulnerabilità di un database gestito in un file di Excel. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Ottiene la baseline della regola di valutazione della vulnerabilità di un database per una determinata regola. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Ottiene la baseline della regola di valutazione della vulnerabilità di un database gestito per una determinata regola. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Ottiene tutti i record di analisi della valutazione della vulnerabilità associati a un determinato database. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord) | Ottiene tutti i record di analisi della valutazione della vulnerabilità associati a un determinato database gestito. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Restituisce le impostazioni di valutazione della vulnerabilità di un database. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Restituisce le impostazioni di valutazione della vulnerabilità di un database gestito. |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Imposta la baseline della regola di valutazione della vulnerabilità. |
| [Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Imposta la baseline della regola di valutazione della vulnerabilità per un database gestito. |
| [Start-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Attiva l'avvio di un'analisi di valutazione della vulnerabilità in un database. |
| [Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Attiva l'avvio di un'analisi di valutazione della vulnerabilità in un database gestito. |
| [Update-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Aggiorna le impostazioni di valutazione della vulnerabilità di un database. |
| [Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Aggiorna le impostazioni di valutazione della vulnerabilità di un database gestito. |
| [Update-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting) | Aggiorna le impostazioni di valutazione della vulnerabilità di un'istanza gestita. |
| &nbsp; | &nbsp; |

Per un esempio di script, vedere Supporto per la [valutazione della vulnerabilità SQL di Azure](/archive/blogs/sqlsecurity/azure-sql-vulnerability-assessment-now-with-powershell-support).

### <a name="using-resource-manager-templates"></a>Uso dei modelli di Resource Manager

Per configurare le linee di base di valutazione della vulnerabilità usando Azure Resource Manager modelli, usare il `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` tipo.

Assicurarsi di aver abilitato prima di aggiungere le basi di `vulnerabilityAssessments` riferimento.

Di seguito è riportato un esempio per la definizione della regola di base VA2065 in `master` database e VA1143 nel `user` database come risorse in un modello di gestione risorse:

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

Per `master` database e `user` database, i nomi delle risorse sono definiti in modo diverso:

- Database master-"nome": "[Concat (parametri (' server_name '),'/', parametri (' database_name '),'/default/VA2065/<b>Master</b>')]",
- Database utente-"nome": "[Concat (parametri (' server_name '),'/', parametri (' database_name '),'/default/VA2065/<b>default</b>')]",

Per gestire i tipi booleani come true/false, impostare il risultato della linea di base con input binario come "1"/"0".

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Passaggi successivi  

- Vedere altre informazioni su [Azure Defender per SQL](azure-defender-for-sql.md).
- Altre informazioni sull' [individuazione e la classificazione dei dati](data-discovery-and-classification-overview.md).
- Altre informazioni sull' [archiviazione dei risultati dell'analisi di valutazione della vulnerabilità in un account di archiviazione accessibile dietro i firewall e reti virtuali](sql-database-vulnerability-assessment-storage.md).