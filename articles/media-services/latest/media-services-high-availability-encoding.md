---
title: Disponibilità elevata con servizi multimediali e video on demand (VOD)
description: Questo articolo è una panoramica dei servizi di Azure che è possibile usare per facilitare la disponibilità elevata per l'applicazione VOD.
services: media-services
documentationcenter: ''
author: IngridAtMicrosoft
manager: femila
editor: ''
ms.service: media-services
ms.subservice: ''
ms.workload: ''
ms.topic: article
ms.custom: ''
ms.date: 07/15/2020
ms.author: inhenkel
ms.openlocfilehash: 9be5aa48b140ee9eb43141d6699109ef12ebf949
ms.sourcegitcommit: 3543d3b4f6c6f496d22ea5f97d8cd2700ac9a481
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/20/2020
ms.locfileid: "86519985"
---
# <a name="high-availability-with-media-services-and-video-on-demand-vod"></a>Disponibilità elevata con servizi multimediali e video on demand (VOD)

## <a name="high-availability-for-vod"></a>Disponibilità elevata per VOD

È disponibile un modello di progettazione a disponibilità elevata denominato [geodi](https://docs.microsoft.com/azure/architecture/patterns/geodes) nella documentazione sull'architettura di Azure. Descrive il modo in cui vengono distribuite le risorse duplicate in aree geografiche diverse per garantire scalabilità e resilienza.  È possibile usare i servizi di Azure per creare un'architettura di questo tipo per coprire molte considerazioni sulla progettazione della disponibilità elevata, ad esempio ridondanza, monitoraggio dello stato, bilanciamento del carico e backup e ripristino dei dati.  Una di tali architetture è illustrata di seguito con i dettagli su ogni servizio usato nella soluzione, nonché su come i singoli servizi possono essere usati per creare un'architettura a disponibilità elevata per l'applicazione VOD.

### <a name="sample"></a>Esempio

È disponibile un esempio che consente di acquisire familiarità con la disponibilità elevata con servizi multimediali e video on demand (VOD). Sono inoltre disponibili informazioni più dettagliate sul modo in cui i servizi vengono utilizzati per uno scenario VOD.  L'esempio non deve essere utilizzato nell'ambiente di produzione nel formato corrente.  Esaminare attentamente il codice di esempio e il file Leggimi, in particolare la sezione relativa alle [modalità di errore](https://github.com/Azure-Samples/media-services-v3-dotnet/tree/master/HighAvailabilityEncodingStreaming) prima di integrarlo in un'applicazione di produzione.  Un'implementazione di produzione di disponibilità elevata per video on demand (VOD) dovrebbe anche esaminare attentamente la strategia di rete per la distribuzione di contenuti (CDN).  Vedere il [codice su GitHub](https://github.com/Azure-Samples/media-services-v3-dotnet/tree/master/HighAvailabilityEncodingStreaming).

## <a name="overview-of-services"></a>Panoramica dei servizi

I servizi usati in questa architettura di esempio includono:

| Icona | Nome | Descrizione |
| :--: | ---- | ----------- |
|![image](media/media-services-high-availability-encoding/azure-media-services.svg)| Account servizi multimediali | **Descrizione:**<br>Un account di servizi multimediali è il punto di partenza per gestire, crittografare, codificare, analizzare e trasmettere contenuti multimediali in Azure. È associato a una risorsa dell'account di archiviazione di Azure. L'account e tutte le archiviazioni associate devono trovarsi nella stessa sottoscrizione di Azure.<br><br>**Uso VOD:**<br>Si tratta dei servizi usati per codificare e distribuire le risorse audio e video.  Per la disponibilità elevata, è necessario configurare almeno due account di servizi multimediali, ognuno in un'area diversa. [Scopri di più su servizi multimediali di Azure](media-services-overview.md). |
|![image](media/media-services-high-availability-encoding/storage-account.svg)| Account di archiviazione | **Descrizione:**<br>Un account di archiviazione di Azure contiene tutti gli oggetti dati di archiviazione di Azure: BLOB, file, code, tabelle e dischi. I dati sono accessibili da qualsiasi parte del mondo tramite HTTP o HTTPS.<br><br>Ogni account di servizi multimediali, in ogni area, avrà un account di archiviazione nella stessa area.<br><br>**Uso VOD:**<br>È possibile archiviare i dati di input e di output per l'elaborazione e il flusso VOD. [Altre informazioni su archiviazione di Azure](https://docs.microsoft.com/azure/storage/common/storage-introduction). |
|![image](media/media-services-high-availability-encoding/storage-account-queue.svg)| Coda di archiviazione di Azure | **Descrizione:**<br>Il servizio di archiviazione di accodamento di Azure consente di archiviare grandi quantità di messaggi ai quali è possibile accedere da qualsiasi parte del mondo mediante chiamate autenticate tramite HTTP o HTTPS.<br><br>**Uso VOD:**<br>Le code possono essere usate per inviare e ricevere messaggi per coordinare le attività tra moduli diversi. L'esempio usa una coda di archiviazione di Azure, ma Azure fornisce altri tipi di code, ad esempio il bus di servizio e Service Fabric code affidabili, che potrebbero essere più adatte alle proprie esigenze. [Scopri di più sulla coda di Azure](https://docs.microsoft.com/azure/storage/queues/storage-queues-introduction). |
|![image](media/media-services-high-availability-encoding/azure-cosmos-db.svg)| Azure Cosmos DB  | **Descrizione:**<br>Azure Cosmos DB è il servizio di database multimodello distribuito a livello globale di Microsoft che scala in modo indipendente la velocità effettiva e l'archiviazione in qualsiasi numero di aree di Azure in tutto il mondo.<br><br>**Uso VOD:**<br>È possibile usare le tabelle per archiviare i record di stato dell'output del processo e per tenere traccia dello stato di integrità di ogni istanza di servizi multimediali. È anche possibile tenere traccia o registrare lo stato di ogni chiamata all'API di servizi multimediali. [Altre informazioni su Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/introduction).  |
|![image](media/media-services-high-availability-encoding/managed-identity.svg)| Identità gestita | **Descrizione:**<br>Identità gestita è una funzionalità di Azure AD che fornisce un'identità gestita automaticamente in Azure AD. Può essere usato per eseguire l'autenticazione a qualsiasi servizio che supporti l'autenticazione Azure AD, incluso Key Vault, senza archiviare le credenziali nel codice.<br><br>**Uso VOD:**<br>Funzioni di Azure può usare l'identità gestita per autenticare le istanze di servizi multimediali per connettersi a Key Vault. [Altre informazioni sull'identità gestita](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview). |
|![image](media/media-services-high-availability-encoding/key-vault.svg)| Key Vault | **Descrizione:**<br>Azure Key Vault può essere usato per archiviare in modo sicuro e controllare rigorosamente l'accesso a token, password, certificati, chiavi API e altri segreti. Può essere usato anche come soluzione di gestione delle chiavi. Con Azure Key Vault è semplice creare e controllare le chiavi di crittografia usate per crittografare i dati. Consente di eseguire facilmente il provisioning, la gestione e la distribuzione di certificati Transport Layer Security/Secure Sockets Layer (TLS/SSL) pubblici e privati da usare con Azure e le risorse connesse interne. I segreti e le chiavi possono essere protetti tramite software o FIPS 140-2 livello 2 convalidato HSM.<br><br>**Uso VOD:**<br>Key Vault può essere usato per configurare i criteri di accesso per l'entità servizio per l'applicazione.  Può essere usato per archiviare la stringa di connessione negli account di archiviazione. Si usa Key Vault per archiviare le stringhe di connessione negli account di archiviazione e in Cosmos DB. È inoltre possibile utilizzare Key Vault per archiviare la configurazione complessiva del cluster. Per ogni istanza del servizio multimediale è possibile archiviare l'ID sottoscrizione, il nome del gruppo di risorse e il nome dell'account. Per ulteriori informazioni, vedere come viene utilizzata nell'esempio. [Altre informazioni su Key Vault](https://docs.microsoft.com/azure/key-vault/general/overview). |
|![image](media/media-services-high-availability-encoding/function-app.svg)| Funzioni di Azure | **Descrizione:**<br>Eseguire piccole parti di codice, denominate "funzioni", senza doversi preoccupare dell'infrastruttura dell'applicazione con funzioni di Azure. [Altre informazioni su funzioni di Azure](https://docs.microsoft.com/azure/azure-functions/functions-overview).<br><br>**Uso VOD:**<br>Funzioni di Azure può essere usato per archiviare l'host dei moduli dell'applicazione VOD.  I moduli per un'applicazione VOD possono includere:<br><br>**Modulo di pianificazione del processo**<br>Il modulo di pianificazione dei processi è per l'invio di nuovi processi a un cluster di servizi multimediali (due o più istanze in aree diverse). Consente di tenere traccia dello stato di integrità di ogni istanza di servizi multimediali e di inviare un nuovo processo alla successiva istanza di integro.<br><br>**Modulo stato processo**<br>Il modulo stato processo è in ascolto degli eventi di stato dell'output del processo provenienti dal servizio griglia di eventi di Azure. Archivia gli eventi nell'archivio eventi per ridurre al minimo il numero di chiamate alle API di servizi multimediali da parte dei moduli.<br><br>**Modulo integrità istanza**<br>Questo modulo tiene traccia dei processi inviati e determina lo stato di integrità di ogni istanza di servizi multimediali. Rileva i processi finiti, i processi non riusciti e i processi che non sono mai stati completati.<br><br>**Modulo di provisioning**<br>Questo modulo esegue il provisioning degli asset elaborati. Copia i dati delle risorse in tutte le istanze di servizi multimediali e configura il servizio front door di Azure per assicurarsi che gli asset possano essere trasmessi anche se alcune istanze di servizi multimediali non sono disponibili. Consentirà anche di configurare i localizzatori di streaming.<br><br>**Modulo di verifica del processo**<br>Questo modulo tiene traccia di ogni processo inviato, invia nuovamente i processi non riusciti ed esegue la pulizia dei dati del processo una volta completato il processo.  |
|![image](media/media-services-high-availability-encoding/application-service.svg)| Servizio app (e piano)  | **Descrizione:**<br>Il Servizio app di Azure è un servizio per l'hosting di applicazioni Web, API REST e back-end mobili, basato su HTTP. Supporta .NET, .NET Core, Java, Ruby, Node.js, PHP o Python. Le applicazioni vengono eseguite e ridimensionate in ambienti basati su Windows e Linux.<br><br>**Uso VOD:**<br>Ogni modulo è ospitato da un servizio app. [Altre informazioni sul servizio app](https://docs.microsoft.com/azure/app-service/overview). |
|![image](media/media-services-high-availability-encoding/azure-front-door.svg)| Frontdoor di Azure | **Descrizione:**<br>Il front-end di Azure viene usato per definire, gestire e monitorare il routing globale del traffico Web ottimizzando per ottenere prestazioni ottimali e un rapido failover globale per la disponibilità elevata.<br><br>**Uso VOD:**<br>Lo sportello anteriore di Azure può essere usato per instradare il traffico agli endpoint di streaming. [Altre informazioni su Azure front door](https://docs.microsoft.com/azure/frontdoor/front-door-overview).  |
|![image](media/media-services-high-availability-encoding/event-grid-subscription.svg)| Griglia di eventi di Azure | **Descrizione:**<br>Creato per le architetture basate su eventi, griglia di eventi include il supporto predefinito per gli eventi provenienti dai servizi di Azure, ad esempio BLOB di archiviazione e gruppi di risorse. Dispone inoltre del supporto per gli eventi di argomento personalizzati. I filtri possono essere usati per indirizzare eventi specifici a endpoint diversi, il multicast a più endpoint e per assicurarsi che gli eventi vengano recapitati in modo affidabile. Ottimizza la disponibilità con la distribuzione nativa tra più domini di errore in ogni area e tra le zone di disponibilità.<br><br>**Uso VOD:**<br>Griglia di eventi consente di tenere traccia di tutti gli eventi dell'applicazione e di archiviarli per salvare in modo permanente lo stato del processo. [Scopri di più su griglia di eventi di Azure](https://docs.microsoft.com/azure/event-grid/overview). |
|![image](media/media-services-high-availability-encoding/application-insights.svg)| Application Insights | **Descrizione:** <br>Application Insights, una funzionalità di Monitoraggio di Azure, è un servizio estendibile di gestione delle prestazioni dell''applicazione per sviluppatori e professionisti DevOps. Viene usato per monitorare le applicazioni attive. Rileva le anomalie delle prestazioni e include gli strumenti di analisi per diagnosticare i problemi e per capire cosa fanno gli utenti con un'app. Il servizio è progettato per supportare il miglioramento continuo delle prestazioni e dell'usabilità.<br><br>**Uso VOD:**<br>Tutti i log possono essere inviati a Application Insights. Sarebbe possibile vedere quale istanza ha elaborato ogni processo cercando i messaggi di processo creati correttamente. Potrebbe contenere tutti i metadati del processo inviati, incluse le informazioni sull'identificatore univoco e sul nome dell'istanza. [Altre informazioni su Application Insights](https://docs.microsoft.com/azure/azure-monitor/app/app-insights-overview). |
## <a name="architecture"></a>Architettura

Questo diagramma di alto livello Mostra l'architettura dell'esempio fornito per iniziare a usare servizi multimediali e disponibilità elevata.

[![Diagramma ](media/media-services-high-availability-encoding/high-availability-architecture.svg) dell'architettura di alto livello di video on demand (VOD)](media/media-services-high-availability-encoding/high-availability-architecture.svg#lightbox)

## <a name="best-practices"></a>Procedure consigliate

### <a name="regions"></a>Regioni

* [Creare](https://review.docs.microsoft.com/azure/media-services/latest/create-account-cli-how-to) due o più account di servizi multimediali di Azure. I due account devono trovarsi in aree diverse. Per altre informazioni, vedere [aree in cui viene distribuito il servizio servizi multimediali di Azure](https://azure.microsoft.com/global-infrastructure/services/?products=media-services).
* Caricare i file multimediali nella stessa area da cui si prevede di inviare il processo. Per altre informazioni su come avviare la codifica, vedere [creare un input del processo da un URL HTTPS](https://review.docs.microsoft.com/azure/media-services/latest/job-input-from-http-how-to) o [creare un input del processo da un file locale](https://review.docs.microsoft.com/azure/media-services/latest/job-input-from-local-file-how-to).
* Se è necessario inviare nuovamente il [processo](https://review.docs.microsoft.com/azure/media-services/latest/transforms-jobs-concept) a un'altra area, è possibile usare `JobInputHttp` o usare `Copy-Blob` per copiare i dati dal contenitore di asset di origine a un contenitore di asset nell'area alternativa.

### <a name="monitoring"></a>Monitoraggio

* Sottoscrivere `JobStateChange` i messaggi in ogni account tramite griglia di eventi di Azure.
    * Eseguire la [registrazione per gli eventi](https://review.docs.microsoft.com/azure/media-services/latest/reacting-to-media-services-events) tramite il portale di Azure o l'interfaccia della riga di comando (è anche possibile usare EVENTGRID Management SDK)
    * Usare [Microsoft. Azure. EVENTGRID SDK](https://www.nuget.org/packages/Microsoft.Azure.EventGrid/) (che supporta gli eventi di servizi multimediali in modo nativo).
    * È anche possibile utilizzare gli eventi di griglia di eventi tramite funzioni di Azure.

    Per altre informazioni:

    * Vedere l' [esempio di analisi audio](https://review.docs.microsoft.com/azure/media-services/latest/transforms-jobs-concept) che Mostra come monitorare un processo con griglia di eventi di Azure, inclusa l'aggiunta di un fallback nel caso in cui i messaggi di griglia di eventi di Azure vengano ritardati per qualche motivo.
    * Esaminare gli [schemi di griglia di eventi di Azure per gli eventi di servizi multimediali](https://review.docs.microsoft.com/azure/media-services/latest/media-services-event-schemas).

* Quando si crea un [processo](https://review.docs.microsoft.com/azure/media-services/latest/transforms-jobs-concept):
    * Selezionare in modo casuale un account dall'elenco degli account attualmente in uso (questo elenco conterrà normalmente entrambi gli account, ma se vengono rilevati problemi potrebbe contenere un solo account). Se l'elenco è vuoto, viene generato un avviso in modo che un operatore possa esaminarlo.
    * Creare un record per tenere traccia di ogni processo in corso e dell'area/account usato.
* Quando il `JobStateChange` gestore riceve una notifica che un processo ha raggiunto lo stato pianificato, registra la data e l'ora in cui viene inserito lo stato pianificato e l'area o l'account usato.
* Quando il `JobStateChange` gestore riceve una notifica relativa al raggiungimento dello stato di elaborazione da parte di un processo, contrassegnare il record per il processo come elaborazione e registrare l'ora in cui entra nello stato di elaborazione.
* Quando il `JobStateChange` gestore riceve una notifica che un processo ha raggiunto uno stato finale (terminato/con errori/annullato), contrassegnare il record per il processo in modo appropriato.
* Disporre di un processo separato che analizza periodicamente i record dei processi
    * Se nello stato pianificato sono presenti processi che non sono stati avanzati per lo stato di elaborazione in un periodo di tempo ragionevole per una determinata area, rimuovere tale area dall'elenco degli account attualmente in uso. A seconda dei requisiti aziendali, è possibile decidere di annullare immediatamente tali processi e di inviarli nuovamente all'altra area. In alternativa, è possibile concedere loro più tempo per passare allo stato successivo.
    * Se un'area è stata rimossa dall'elenco di account, monitorarla per il ripristino prima di aggiungerla di nuovo all'elenco. L'integrità regionale può essere monitorata tramite i processi esistenti nell'area (se non sono stati annullati e inviati nuovamente), aggiungendo l'account all'elenco dopo un periodo di tempo e dagli operatori che monitorano le comunicazioni di Azure sulle interruzioni che potrebbero influire su servizi multimediali di Azure.

## <a name="next-steps"></a>Passaggi successivi

* [Creazione di flussi di video su richiesta tra aree](media-services-high-availability-streaming.md)
* Estrai [esempi di codice](https://docs.microsoft.com/samples/browse/?products=azure-media-services)
