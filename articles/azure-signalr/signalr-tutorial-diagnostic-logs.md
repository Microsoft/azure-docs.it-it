---
title: Log di diagnostica per il servizio SignalR di AzureDiagnostic Logs for Azure SignalR Service
description: Informazioni su come configurare i log di diagnostica per il servizio SignalR di Azure e su come usarlo per risolvere i problemi di posta elettronica.
author: wanlwanl
ms.service: signalr
ms.topic: conceptual
ms.date: 12/17/2019
ms.author: wanl
ms.openlocfilehash: 72f57ba4bbbbde07f6d26edc88c158f301ebe2f2
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/28/2020
ms.locfileid: "79536735"
---
# <a name="diagnostic-logs-for-azure-signalr-service"></a>Log di diagnostica per il servizio SignalR di AzureDiagnostic Logs for Azure SignalR Service

Questa esercitazione illustra i log di diagnostica per il servizio SignalR di Azure e come configurare i log di diagnostica e come risolvere i problemi con i log di diagnostica.

## <a name="prerequisites"></a>Prerequisiti
Per abilitare i log di diagnostica, è necessario un punto in cui archiviare i dati di log. Questa esercitazione usa Archiviazione di Azure e Log Analytics.This tutorial uses Azure Storage and Log Analytics.

* [Archiviazione di Azure:](../azure-monitor/platform/resource-logs-collect-storage.md) mantiene i log di diagnostica per il controllo dei criteri, l'analisi statica o il backup.
* [Log Analytics:](../azure-monitor/platform/resource-logs-collect-workspace.md) strumento flessibile di ricerca e analisi dei log che consente l'analisi dei log non elaborati generati da una risorsa di Azure.Log Analytics - A flexible log search and analytics tool that allows for analysis of raw logs generated by an Azure resource.

## <a name="set-up-diagnostic-logs-for-an-azure-signalr-service"></a>Configurare i log di diagnostica per un servizio SignalR di AzureSet up diagnostic logs for an Azure SignalR Service

È possibile visualizzare i log di diagnostica per il servizio SignalR di Azure.You can view diagnostic logs for Azure SignalR Service. Questi log offrono una visualizzazione più avanzata della connettività all'istanza del servizio SignalR di Azure.These logs provide richer view of connectivity to your Azure SignalR Service instance. I log di diagnostica forniscono informazioni dettagliate su ogni connessione. Ad esempio, le informazioni di base (ID utente, ID di connessione e tipo di trasporto e così via) e le informazioni sull'evento (connessione, disconnessione e interruzione evento e così via) della connessione. I log diagnostici possono essere utilizzati per l'identificazione dei problemi, il rilevamento delle connessioni e l'analisi.

### <a name="enable-diagnostic-logs"></a>Abilitare i log di diagnostica

I log di diagnostica sono disabilitati per impostazione predefinita. Per abilitare i log di diagnostica, eseguire i passaggi seguenti:

1. Nel [portale di Azure](https://portal.azure.com), in **Monitoraggio**, fare clic su Impostazioni **di diagnostica**.

    ![Spostamento del riquadro alle impostazioni di diagnostica](./media/signalr-tutorial-diagnostic-logs/diagnostic-settings-menu-item.png)

1. Quindi fare clic su **Aggiungi impostazione diagnostica**.

    ![Aggiungere log di diagnosticaAdd diagnostic logs](./media/signalr-tutorial-diagnostic-logs/add-diagnostic-setting.png)

1. Impostare la destinazione di archiviazione desiderata. Attualmente, è supportata **l'archiviazione in un account di archiviazione** e **l'invio a Log Analytics**.

1. Selezionare i registri che si desidera archiviare.

    ![Riquadro Impostazioni di diagnostica](./media/signalr-tutorial-diagnostic-logs/diagnostics-settings-pane.png)


1. Salvare le nuove impostazioni di diagnostica.

Le nuove impostazioni diventano effettive in circa 10 minuti. Trascorso questo tempo, i log vengono visualizzati nella destinazione di archiviazione configurata, nel riquadro **Log di diagnostica**.

Per altre informazioni sulla configurazione della diagnostica, vedere la [panoramica dei log di diagnostica di Azure](../azure-monitor/platform/platform-logs-overview.md).

### <a name="diagnostic-logs-categories"></a>Categorie dei log di diagnostica

Il servizio SignalR di Azure acquisisce i log di diagnostica in una categoria:Azure SignalR Service captures diagnostic logs in one category:

* **Tutti i log:** tenere traccia delle connessioni che si connettono al servizio SignalR di Azure.All Logs : Track connections that connect to Azure SignalR Service. I log forniscono informazioni sulla connessione/disconnessione, l'autenticazione e la limitazione delle richieste. Per ulteriori informazioni, vedere la sezione successiva.

### <a name="archive-to-a-storage-account"></a>Archivia in un account di archiviazione

I log vengono archiviati nell'account di archiviazione configurato nel riquadro **Log di diagnostica.** Un contenitore denominato `insights-logs-alllogs` viene creato automaticamente per archiviare i log di diagnostica. All'interno del contenitore, `resourceId=/SUBSCRIPTIONS/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX/RESOURCEGROUPS/XXXX/PROVIDERS/MICROSOFT.SIGNALRSERVICE/SIGNALR/XXX/y=YYYY/m=MM/d=DD/h=HH/m=00/PT1H.json`i log vengono memorizzati nel file . Fondamentalmente, il percorso `resource ID` `Date Time`è combinato da e . I file di `hour`registro vengono suddivisi per . Pertanto, i `m=00`minuti sono sempre .

Tutti i log vengono archiviati in formato JavaScript Object Notation (JSON). Ogni voce presenta campi stringa che usano il formato descritto nelle sezioni seguenti.

Le stringhe JSON del log di archiviazione includono elementi elencati nelle tabelle seguenti:Archive log JSON strings include elements listed in the following tables:

**Format**

Nome | Descrizione
------- | -------
time | Registrare l'ora dell'evento
level | Registra livello evento
resourceId | ID risorsa del servizio SignalR di AzureResource ID of your Azure SignalR Service
posizione | Posizione del servizio SignalR di AzureLocation of your Azure SignalR Service
category | Categoria dell'evento di registro
operationName | Nome dell'operazione dell'evento
callerIpAddress | Indirizzo IP del server/client
properties | Proprietà dettagliate correlate a questo evento di registro. Per ulteriori dettagli, vedere la tabella delle proprietà seguente

**Tabella Delle proprietà**

Nome | Descrizione
------- | -------
type | Tipo dell'evento di registro. Attualmente vengono fornite informazioni sulla connettività al servizio SignalR di Azure.Currently, we provide information about connectivity to the Azure SignalR Service. Solo `ConnectivityLogs` il tipo è disponibile
collection | Raccolta dell'evento di registro. I valori `Connection`consentiti sono: , `Authorization` e`Throttling`
connectionId | Identità della connessione
transportType (tipo di trasporto) | Tipo di trasporto della connessione. I valori `Websockets` \| `ServerSentEvents` \| consentiti sono:`LongPolling`
connectionType | Tipo di connessione. I valori consentiti sono: `Server` \| `Client`. `Server`: connessione dal lato server; `Client`: connessione dal lato client
userId | Identità dell'utente
message | Messaggio dettagliato dell'evento di registro

Il codice seguente è un esempio di stringa JSON di log di archiviazione:

```json
{
    "properties": {
        "message": "Entered Serverless mode.",
        "type": "ConnectivityLogs",
        "collection": "Connection",
        "connectionId": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
        "userId": "User",
        "transportType": "WebSockets",
        "connectionType": "Client"
    },
    "operationName": "ServerlessModeEntered",
    "category": "AllLogs",
    "level": "Informational",
    "callerIpAddress": "xxx.xxx.xxx.xxx",
    "time": "2019-01-01T00:00:00Z",
    "resourceId": "/SUBSCRIPTIONS/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX/RESOURCEGROUPS/XXXX/PROVIDERS/MICROSOFT.SIGNALRSERVICE/SIGNALR/XXX",
    "location": "xxxx"
}
```

### <a name="archive-logs-schema-for-log-analytics"></a>Schema dei log di archiviazione per Log Analytics

Per visualizzare i log di diagnostica, attenersi alla seguente procedura:

1. Fare `Logs` clic nella destinazione Log Analytics.

    ![Voce di menu Log Analytics](./media/signalr-tutorial-diagnostic-logs/log-analytics-menu-item.png)

2. Immettere `SignalRServiceDiagnosticLogs` e selezionare l'intervallo di tempo per eseguire query sui log di diagnostica. Per una query avanzata, vedere [Introduzione a Log Analytics in Monitoraggio di AzureFor](../azure-monitor/log-query/get-started-portal.md) advanced query, see Get started with Log Analytics in Azure Monitor

    ![Query log in Log Analytics](./media/signalr-tutorial-diagnostic-logs/query-log-in-log-analytics.png)

Le colonne del log di archiviazione includono gli elementi elencati nella tabella seguente:Archive log columns include elements listed in the following table:

Nome | Descrizione
------- | ------- 
TimeGenerated | Registrare l'ora dell'evento
Raccolta | Raccolta dell'evento di registro. I valori `Connection`consentiti sono: , `Authorization` e`Throttling`
OperationName | Nome dell'operazione dell'evento
Location | Posizione del servizio SignalR di AzureLocation of your Azure SignalR Service
Level | Registra livello evento
CallerIpAddress | Indirizzo IP del server/client
Message | Messaggio dettagliato dell'evento di registro
UserId | Identità dell'utente
ConnectionId | Identità della connessione
ConnectionType | Tipo di connessione. I valori consentiti sono: `Server` \| `Client`. `Server`: connessione dal lato server; `Client`: connessione dal lato client
TransportType | Tipo di trasporto della connessione. I valori `Websockets` \| `ServerSentEvents` \| consentiti sono:`LongPolling`

### <a name="troubleshooting-with-diagnostic-logs"></a>Risoluzione dei problemi con i log di diagnosticaTroubleshooting with diagnostic logs

Per risolvere i problemi relativi al servizio SignalR di Azure, è possibile abilitare i log lato server/client per acquisire gli errori. Al momento, il servizio SignalR di Azure espone i log di diagnostica, è anche possibile abilitare i log per il lato servizio.

Quando si verifica la connessione imprevista situazione crescente o in caduta, è possibile sfruttare i log di diagnostica per risolvere i problemi.

I problemi tipici riguardano spesso le modifiche impreviste della quantità delle connessioni, i limiti di connessione e gli errori di autorizzazione. Vedere le sezioni successive sulla risoluzione dei problemi.

#### <a name="unexpected-connection-number-changes"></a>Modifiche del numero di connessione impreviste

##### <a name="unexpected-connection-dropping"></a>Arresto imprevisto della connessione

Se si verifica un calo imprevisto delle connessioni, abilitare innanzitutto i log nei lati del servizio, del server e del client.

Se una connessione si disconnette, i log di `ConnectionAborted` diagnostica `ConnectionEnded` `operationName`registreranno questo evento di disconnessione, verrà visualizzato o in .

La differenza `ConnectionAborted` `ConnectionEnded` tra `ConnectionEnded` ed è che è una disconnessione prevista che viene attivata dal lato client o server. Mentre `ConnectionAborted` l'evento di eliminazione della connessione è in `message`genere imprevisto e il motivo dell'interruzione verrà fornito in .

I motivi di interruzione sono elencati nella tabella seguente:

Motivo | Descrizione
------- | ------- 
Il numero di connessioni raggiunge il limite | Il numero di connessioni raggiunge il limite del livello di prezzo corrente. Considerare l'unità di servizio con scalabilità verticale
Il server applicazioni ha chiuso la connessione | Il server dell'app attiva l'aborto. Può essere considerato come un aborto atteso
Timeout ping connessione | Di solito è causato da problemi di rete. Valutare la possibilità di verificare la disponibilità del server applicazioni da Internet
Ricaricamento del servizio, riconnessione | Il servizio SignalR di Azure è in corso di ricaricamento. Azure SignalR supports auto-reconnecting, you can wait until reconnected or manually reconnect to Azure SignalR Service
Errore temporaneo del server interno | Errore temporaneo si verifica nel servizio SignalR di Azure, deve essere ripristinato automaticamenteTransient error occurs in Azure SignalR Service, should be auto-recovered
Connessione al server interrotta | Connessione al server scende con errore sconosciuto, prendere in considerazione la risoluzione automatica dei problemi con il registro lato servizio/server/client prima. Cerca di escludere i problemi di base (ad es. Problema di rete, problema lato server app e così via). Se il problema non viene risolto, contattaci per ulteriore assistenza. Per altre informazioni, vedere la sezione [Guida.For more information,](#get-help) see Get help section. 

##### <a name="unexpected-connection-growing"></a>Connessione imprevista in crescita

Per risolvere i problemi relativi all'aumento delle connessioni impreviste, la prima cosa da fare è filtrare le connessioni aggiuntive. È possibile aggiungere un ID utente di prova univoco alla connessione client di test. Quindi verificarlo con i log di diagnostica, se vengono visualizzate più connessioni client con lo stesso ID utente o indirizzo IP di prova, è probabile che il lato client crei e stabilisca più connessioni del previsto. Controlla il lato del tuo cliente.

#### <a name="authorization-failure"></a>Errore di autorizzazione

Se viene restituito 401 Non autorizzato per le richieste client, controllare i log di diagnostica. Se riscontri `Failed to validate audience. Expected Audiences: <valid audience>. Actual Audiences: <actual audience>`, significa che tutti i segmenti di pubblico nel tuo token di accesso non sono validi. Provare a utilizzare i gruppi di destinatari validi suggeriti nel registro.


#### <a name="throttling"></a>Limitazione

Se non è possibile stabilire connessioni client SignalR al servizio SignalR di Azure, controllare i log di diagnostica. Se si `Connection count reaches limit` verificano nel log di diagnostica, si stabiliscono troppe connessioni al servizio SignalR, che raggiungono il limite di conteggio delle connessioni. Valutare la possibilità di aumentare il servizio SignalR.Consider scaling up your SignalR Service. Se si `Message count reaches limit` verifica nel log di diagnostica, significa che si utilizza il livello gratuito e si utilizza la quota dei messaggi. Se si desidera inviare più messaggi, è consigliabile modificare il servizio SignalR a livello standard per inviare altri messaggi. Per altre informazioni, vedere Prezzi del servizio SignalR di [Azure.For more information,](https://azure.microsoft.com/pricing/details/signalr-service/)see Azure SignalR Service Pricing .

### <a name="get-help"></a>Ottenere aiuto

Si consiglia di risolvere i problemi da soli. La maggior parte dei problemi sono causati da problemi di rete o server applicazioni. Seguire la [guida alla risoluzione dei problemi con il registro di diagnostica](#troubleshooting-with-diagnostic-logs) e la guida di base per la [risoluzione dei problemi](https://github.com/Azure/azure-signalr/blob/dev/docs/tsg.md) per individuare la causa principale.
Se il problema persiste, provare un problema in GitHub o creare un ticket nel portale di Azure.If the issue still can't be resolved, then consider open an issue in GitHub or create ticket in Azure Portal.
Specificare:
1. Intervallo di tempo di circa 30 minuti quando si verifica il problema
2. ID risorsa del servizio SignalR di AzureAzure SignalR Service's resource ID
3. Dettagli del problema, il più specifico possibile: ad esempio, appserver non invia messaggi, la connessione client viene rilasciata e così via
4. Registri raccolti dal lato server/client e altro materiale che potrebbe essere utile
5. [Facoltativo] Codice Repro

> [!NOTE]
> Se si apre il problema in GitHub, mantenere private le informazioni riservate (ad esempio, ID risorsa, log server/client), inviare solo ai membri dell'organizzazione Microsoft privatamente.