---
title: "Azure AD Connect: Eseguire la migrazione di gruppi da una foresta a un'altra. Documenti Microsoft"
description: Questo articolo descrive i passaggi necessari per eseguire correttamente la migrazione dei gruppi da una foresta a un'altra per Azure AD Connect.This article describes the steps needed to successfully migrate groups from one forest to another for Azure AD Connect.
services: active-directory
author: billmath
manager: daveba
ms.service: active-directory
ms.topic: reference
ms.workload: identity
ms.date: 04/02/2020
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 298cfa58d008fbeb0d58cdcff61b27fa1819ee1d
ms.sourcegitcommit: bc738d2986f9d9601921baf9dded778853489b16
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/02/2020
ms.locfileid: "80620831"
---
# <a name="migrate-groups-from-one-forest-to-another-for-azure-ad-connect"></a>Eseguire la migrazione di gruppi da una foresta a un'altra per Azure AD ConnectMigrate groups from one forest to another for Azure AD Connect

In questo articolo vengono descritti i passaggi necessari per eseguire correttamente la migrazione dei gruppi da una foresta a un'altra in modo che gli oggetti gruppo migrati corrispondano agli oggetti esistenti nel cloud.

## <a name="prerequisites"></a>Prerequisiti

- Azure AD Connect versione 1.5.18.0 o successivaAzure AD Connect version 1.5.18.0 or versione successiva
- L'attributo Ancoraggio di origine è`mS-DS-ConsistencyGuid`

A partire dalla versione 1.5.18.0, Azure AD `mS-DS-ConsistencyGuid` Connect ha iniziato a supportare l'uso di per i gruppi. Se `mS-DS-ConsistencyGuid` viene scelto come attributo di ancoraggio di origine e il `mS-DS-ConsistencyGuid` valore viene popolato in Active Directory, Azure AD Connect usa il valore di come immutableId. In caso contrario, `objectGUID`viene emesso il fallback all'utilizzo di . Tuttavia, si noti **DOES NOT** che Azure AD Connect `mS-DS-ConsistencyGuid` NON riscrivere il valore nell'attributo in Active Directory.

Durante uno scenario di spostamento tra foreste in cui un oggetto gruppo viene spostato da una foresta (ad `mS-DS-ConsistencyGuid` esempio F1) `objectGUID` a un'altra foresta (ad `mS-DS-ConsistencyGuid` esempio F2), sarà necessario copiare il valore (Se PRESENTE) o il valore dall'oggetto nella foresta F1 all'attributo dell'oggetto in F2. 

Utilizzare gli script seguenti come linee guida per vedere come è possibile eseguire la migrazione di un singolo gruppo dalla foresta F1 alla foresta F2. Si prega di sentirsi liberi di utilizzare questo come una linea guida per fare la migrazione per più gruppi.

In primo luogo, otteniamo l'oggetto `objectGUID` di gruppo e `mS-DS-ConsistencyGuid` nella foresta F1. Questi attributi vengono esportati in un file CSV.
```
<#
DESCRIPTION
============
This script will take DN of a group as input.
It then copies the objectGUID and mS-DS-ConsistencyGuid values along with other attributes of the given group to a CSV file.

This CSV file can then be used as input to Export-Group script
#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $outputCsv
)

$defaultProperties = @('samAccountName', 'distinguishedName', 'objectGUID', 'mS-DS-ConsistencyGuid')
$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -Properties $defaultProperties -ErrorAction Stop
$results = @()
if ($group -eq $null)
{
       Write-Error "Group not found"
}
else
{
       $objectGUIDValue = [GUID]$group.'objectGUID'
       $mSDSConsistencyGuidValue = "N/A"
       if ($group.'mS-DS-ConsistencyGuid' -ne $null)
       {
              $mSDSConsistencyGuidValue = [GUID]$group.'mS-DS-ConsistencyGuid'
       }
       $adgroup = New-Object -TypeName PSObject
       $adgroup | Add-Member -MemberType NoteProperty -Name samAccountName -Value $($group.'samAccountName')
       $adgroup | Add-Member -MemberType NoteProperty -Name distinguishedName -Value $($group.'distinguishedName')
       $adgroup | Add-Member -MemberType NoteProperty -Name objectGUID -Value $($objectGUIDValue)
       $adgroup | Add-Member -MemberType NoteProperty -Name mS-DS-ConsistencyGuid -Value $($mSDSConsistencyGuidValue)
       $results += $adgroup
}

Write-Host "Exporting group to output file"
$results | Export-Csv "$outputCsv" -NoTypeInformation

```

Successivamente, utilizziamo il file CSV `mS-DS-ConsistencyGuid` di output generato per timbrare l'attributo sull'oggetto di destinazione nell'insieme di strutture F2.


```
<#
DESCRIPTION
============
This script will take DN of a group as input and the CSV file that was generated by Import-Group script
It copies either the objectGUID or mS-DS-ConsistencyGuid value from CSV file to the given object.

#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $inputCsv
)

$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -ErrorAction Stop
if ($group -eq $null)
{
       Write-Error "Group not found"
}

$csvFile = Import-Csv -Path $inputCsv -ErrorAction Stop
$msDSConsistencyGuid = [GUID] $csvFile.'mS-DS-ConsistencyGuid'
$objectGuid = [GUID] $csvFile.'objectGUID'
$targetGuid = $msDSConsistencyGuid

if ($msDSConsistencyGuid -eq "N/A")
{
       $targetGuid = $objectGuid
}

Set-ADGroup -Identity $dn -Replace @{'mS-DS-ConsistencyGuid'=$targetGuid} -ErrorAction Stop

```

## <a name="next-steps"></a>Passaggi successivi
Altre informazioni su [Integrazione delle identità locali con Azure Active Directory](whatis-hybrid-identity.md).
